(function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;!function(a,b){return"object"==typeof exports?module.exports=b.call(a):"function"==typeof define&&define.amd?define(function(){return b.call(a)}):a.evo=b.call(a)}(null!=(a="undefined"!=typeof window&&null!==window)?a:{window:this},function(){var a,c,d,e,f,g;return g={},g.config={pool:{n_genes:200,cross_rate:.04,mutate_rate:.04,mutate_amount:.1,size:100,ratios:{top:.2,mutate:.2,cross:.3,random:.05,meld:.2},on_breed:function(){},on_spawn:void 0},network:{hidden_layers:2,hidden_nodes:4,output_nodes:3,input_nodes:2}},g.util={random:function(a,b){return null==a&&(a=-1),null==b&&(b=1),Math.random()*(b-a)+a},sin:function(a,b,c){return null==b&&(b=1),null==c&&(c=0),Math.sin(a*b*6.2832+c)},gaussian:function(a,b,c){return Math.exp(-Math.pow(b-a,2)*c)},linear:function(a,b,c){return(a+c)*b},flatten:function(a){return a>1?1:-1>a?-1:a},tanh:function(a){var b,c;return-3>a||a>3?g.util.flatten(a):(b=Math.exp(a),c=Math.exp(-a),(b-c)/(b+c))},sample:function(a){return a[Math.floor(Math.random()*a.length)]},shuffle:function(a){var b,c,d,e,f,g;for(d=a.length,g=Array(d),b=c=0,f=d-1;f>=0?f>=c:c>=f;b=f>=0?++c:--c)e=Math.floor(Math.random()*b),e!==b&&(g[b]=g[e]),g[e]=a[b];return g},clone:function(a){var b,c;if(null===a||"object"!=typeof a)return a;c=a.constructor();for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},extend:function(a,b){var c;if(a=g.util.clone(a),null==b)return a;for(c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):a[c]=b[c];return a}},a=function(){function a(){}return a.prototype.config={},a.prototype.on=function(a,b){return this.config["on_"+a]=b,this},a.prototype.trigger=function(a,b){return null==b&&(b=null),null!=this.config["on_"+a]?this.config["on_"+a].call(this,b):void 0},a}(),f=function(a){function c(a){var b,c,d;for(this.config=a,this.generation=0,this.pool=[],this.breedpool=[],this.last_genes={},b=c=1,d=this.config.size;d>=1?d>=c:c>=d;b=d>=1?++c:--c)this.pool.push(this.fresh());this.prev_pool=this.pool.slice(0),this.average=0}return b(c,a),c.prototype.fresh=function(){var a,b,c,d;for(d=[],a=b=1,c=this.config.n_genes;c>=1?c>=b:b>=c;a=c>=1?++b:--b)d.push(g.util.random()*this.config.mutate_amount);return d},c.prototype.clone=function(a){return a.slice(0)},c.prototype.mutate=function(a){var b,c,d,e,f;for(f=[],c=d=0,e=a.length;e>d;c=++d)b=a[c],f[c]=a[c],Math.random()<this.config.mutate_rate&&(f[c]+=g.util.random()*this.config.mutate_amount);return f},c.prototype.cross=function(a,b){var c,d,e,f,g,h;for(h=[],c=!1,e=f=0,g=a.length;g>f;e=++f)d=a[e],Math.random()<this.config.cross_rate&&(c=!c),h.push(c?a[e]:b[e]);return h},c.prototype.meld=function(a,b){var c,d,e,f,g;for(g=[],d=e=0,f=a.length;f>e;d=++e)c=a[d],g.push((a[d]+b[d])/2);return g},c.prototype.spawn=function(){var a,b;return a=this.next(),b=this.trigger("spawn",a),b.genes=a,b.score=0,b.report=function(a){return function(){return a.report(b)}}(this),b},c.prototype.next=function(){if(0===this.pool.length){if(!(this.breedpool.length>0))return this.last=this.fresh();this.generate()}return this.last=this.pool.pop()},c.prototype.report=function(a,b){return null==b&&(b=0),null!=a.score&&null!=a.genes&&(b=a.score,a=a.genes),null==a&&(a=this.last_genes),this.breedpool.push({genes:a,score:b})},c.prototype.mean=function(a){var b,c,d,e;for(c=0,d=0,e=a.length;e>d;d++)b=a[d],c+=b.score;return c/=a.length},c.prototype.generate=function(){var a,b,c,d,e,f,h,i,j,k,l,m,n,o,p,q;for(this.pool=[],this.average=this.mean(this.breedpool),this.breedpool=this.breedpool.sort(function(a,b){return a.score-b.score}),q=this.breedpool.reverse().slice(0,+(this.config.ratios.top*this.config.size)+1||9e9),p=this.config.size,1>p&&(p=0),e=0,f=q.length;f>e;e++)a=q[e],this.pool.push(this.clone(a.genes));for(d=h=1,l=this.config.ratios.mutate*p;l>=1?l>=h:h>=l;d=l>=1?++h:--h)this.pool.push(this.mutate(g.util.sample(q).genes));for(d=i=1,m=this.config.ratios.cross*p;m>=1?m>=i:i>=m;d=m>=1?++i:--i)b=g.util.sample(q).genes,c=g.util.sample(q).genes,this.pool.push(this.cross(b,c));for(d=j=1,n=this.config.ratios.meld*p;n>=1?n>=j:j>=n;d=n>=1?++j:--j)b=g.util.sample(q).genes,c=g.util.sample(q).genes,this.pool.push(this.meld(b,c));for(d=k=1,o=this.config.ratios.random*p;o>=1?o>=k:k>=o;d=o>=1?++k:--k)this.pool.push(this.clone(g.util.sample(this.breedpool).genes));for(;this.pool.length<p;)this.pool.push(this.fresh());return this.generation++,this.prev_pool=this.pool.map(function(a){return a.map(function(a){return Math.round(100*a)/100})}),this.pool=g.util.shuffle(this.pool),this.trigger("breed"),this.breedpool=[]},c.prototype.load=function(a){return this.pool=a.slice(0),this.breedpool=[]},c}(a),g.pool=function(a){return a=g.util.extend(g.config.pool,a),new f(a)},e=function(){function a(a,b){this.config=b}return a.prototype.calc=function(){},a}(),g.network=function(a,b,e){return e=g.util.extend(g.config.network,e),"feedforward"===a?new d(b,e):"cppn"===a?new c(b,e):void 0},c=function(a){function c(a,b){var c,d,e,f,g,h,i;for(this.config=b,this.node_fn=[],c=a.slice(0),d=f=0,h=this.config.hidden_layers-1;h>=0?h>=f:f>=h;d=h>=0?++f:--f)for(this.node_fn[d]=[],e=g=0,i=this.config.hidden_nodes-1;i>=0?i>=g:g>=i;e=i>=0?++g:--g)this.node_fn[d].push(this.get_fn(c.pop()));this.weights=c.slice(0)}return b(c,a),c.node_fn=[g.util.gaussian,g.util.sin,function(a,b,c){return g.util.tanh(g.util.linear(a,b,c))}],c.prototype.get_fn=function(a){var b;return b=Math.round(Math.abs(a)*c.node_fn.length)%c.node_fn.length,c.node_fn[b]},c.prototype.calc=function(a){var b,c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(i=this.config.hidden_nodes,b=this.weights.slice(0),c=[],f=h=0,p=this.config.hidden_layers-1;p>=0?p>=h:h>=p;f=p>=0?++h:--h)for(c[f]=[],d=k=0,q=this.config.hidden_nodes-1;q>=0?q>=k:k>=q;d=q>=0?++k:--k)c[f][d]=0;for(m=0,j=a.length;j>m;m++)for(B=a[m],d=n=0,r=this.config.hidden_nodes-1;r>=0?r>=n:n>=r;d=r>=0?++n:--n)c[0][d]+=B*b.pop();for(f=o=0,s=this.config.hidden_layers-2;s>=0?s>=o:o>=s;f=s>=0?++o:--o)for(d=x=0,t=this.config.hidden_nodes-1;t>=0?t>=x:x>=t;d=t>=0?++x:--x)if(c[f][d]=this.node_fn[f][d](c[f][d],b.pop(),b.pop()),f+1<this.config.hidden_layers)for(e=y=0,u=this.config.hidden_nodes-1;u>=0?u>=y:y>=u;e=u>=0?++y:--y)c[f+1][e]+=c[f][d]*b.pop();for(l=[],e=z=0,v=this.config.output_nodes-1;v>=0?v>=z:z>=v;e=v>=0?++z:--z){for(l[e]=0,d=A=0,w=this.config.hidden_nodes-1;w>=0?w>=A:A>=w;d=w>=0?++A:--A)l[e]+=c[this.config.hidden_layers-1][d]*b.pop();l[e]=g.util.tanh(l[e])}return l},c}(e),d=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.calc=function(a){var b,c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(a.length!==this.config.input)throw Error("Inputs dont match. Expected: "+this.config.input+", Received: "+a.length);for(b=this.weights.slice(0),d=[],f=h=0,t=this.config.hidden_nodes-1;t>=0?t>=h:h>=t;f=t>=0?++h:--h)d[f]=0;for(p=[],f=n=0,u=this.config.output_nodes-1;u>=0?u>=n:n>=u;f=u>=0?++n:--n)p[f]=0;for(q=0,i=a.length;i>q;q++)for(e=a[q],f=r=0,j=d.length;j>r;f=++r)c=d[f],d[f]+=e*b.pop();for(e=s=0,k=d.length;k>s;e=++s)for(c=d[e],d[e]+=b.pop(),d[e]=g.util.tanh(d[e]),f=v=0,l=p.length;l>v;f=++v)o=p[f],p[f]+=d[e]*b.pop();for(e=w=0,m=p.length;m>w;e=++w)o=p[e],p[e]=g.util.flatten(p[e]);return p},c}(e),g})}).call(this);